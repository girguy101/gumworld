<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://unpkg.com/webamp@1.4.0/built/webamp.bundle.min.js"></script> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xgum central, USA</title>
    <link href="dist/style.css" rel="stylesheet">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@xgum9" />
    <meta property="og:url" content="https://gumworld.org/" />
    <meta property="og:title" content="The home of xgum's music" />
    <meta property="og:description" content="xgum creates original music about nostalgia, relationships, and tragedy" />
    <meta property="og:image" content="https://gumworld.org/dist/pic.png" />
</head>
<body>
    <div id="winamp-container"></div>
      <script>
  const Winamp = window.Webamp;
  // All configuration options are optional.
  const webamp = new Webamp({
      // Optional.
      initialTracks: [
          {
              metaData: {
                  artist: "xgum",
                  title: "Jainism Stance (Instrumental)",
              },
              url: "https://files.catbox.mo...", // (Rest of initialTracks)
          },
          // ... (rest of your existing tracks)
      ]
  });
  webamp.renderWhenReady(document.getElementById('winamp-container'));
  </script>

    <main class="content-wrapper">
        <section class="site-content-grid">
            <div class="column-left">
                </div>
            
            <div class="column-right">
                <header class="site-header">
                    <h1>xgum central, USA</h1>
                </header>
                <div class="song-list-container">
                    <ul id="song-list">
                        <li data-song="Jainism Stance">
                            <a href="#" class="song-link">Jainism Stance</a>
                            <div class="lyric-display-container" style="display: none;"></div>
                        </li>
                        <li data-song="Tears of Blue">
                            <a href="#" class="song-link">Tears of Blue</a>
                            <div class="lyric-display-container" style="display: none;"></div>
                        </li>
                        </ul>
                </div>
            </div>
        </section>
        
        <div id="annotation-tooltip" style="display: none;"></div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const LYRICS_PROXY_URL = 'https://your-worker-subdomain.workers.dev'; // ðŸš¨ IMPORTANT: Replace with your actual Worker URL
            const songLinks = document.querySelectorAll('.song-link');

            // --- 1. NEW: Annotation Logic Function ---
            function initializeAnnotationListeners() {
                const annotatedSpans = document.querySelectorAll('.annotated-lyric');
                const tooltip = document.getElementById('annotation-tooltip');
                
                // ðŸš¨ NOTE: This is a placeholder. A complete solution would fetch this content.
                const ANNOTATION_PLACEHOLDER = 'This is a test annotation. The full annotation text would be fetched separately from Genius using the data-id!';

                annotatedSpans.forEach(span => {
                    // --- MOUSE OVER ---
                    span.addEventListener('mouseover', (e) => {
                        tooltip.innerHTML = `<p>${ANNOTATION_PLACEHOLDER}</p>`;
                        tooltip.style.display = 'block';
                        span.classList.add('highlighted');
                    });

                    // --- MOUSE OUT ---
                    span.addEventListener('mouseout', () => {
                        tooltip.style.display = 'none';
                        span.classList.remove('highlighted');
                    });
                    
                    // --- MOUSE MOVE (for cursor tracking) ---
                    span.addEventListener('mousemove', (e) => {
                        // Position near the cursor, with an offset (20px)
                        tooltip.style.left = `${e.clientX + 20}px`;
                        tooltip.style.top = `${e.clientY + 20}px`;
                    });
                });
            }


            // --- 2. UPDATED: Fetch Lyrics Function ---
            async function fetchLyrics(songTitle, targetElement) {
                targetElement.innerHTML = `
                    <h3 class="category-title">${songTitle} - Loading...</h3>
                    <div class="lyrics-html-wrapper">
                        <p class="loading-message">Fetching lyrics from Genius...</p>
                    </div>
                `;
                targetElement.style.display = 'block';

                const url = `${LYRICS_PROXY_URL}?q=xgum ${encodeURIComponent(songTitle)}`;

                try {
                    const response = await fetch(url);
                    const data = await response.json(); 
                    const fetchedHTML = data.lyrics; // Now contains structured HTML
                    const geniusUrl = data.url;

                    if (response.ok && fetchedHTML) {
                        targetElement.innerHTML = `
                            <h3 class="category-title">${songTitle} - Lyrics</h3>
                            <div class="lyrics-html-wrapper">
                                ${fetchedHTML} 
                            </div>
                            <p class="link-highlight" style="margin-top: 20px;"><a href="${geniusUrl || '#'}" target="_blank">View Full Page on Genius</a></p>
                        `;
                        // ðŸš¨ CRITICAL: Call the new initializer function
                        initializeAnnotationListeners(); 

                    } else {
                        targetElement.innerHTML = `
                            <h3 class="category-title">${songTitle} - Error</h3>
                            <p class="error-message">Could not find lyrics or an error occurred. ${data.error || ''}</p>
                        `;
                    }

                } catch (error) {
                    targetElement.innerHTML = `
                        <h3 class="category-title">${songTitle} - Network Error</h3>
                        <p class="error-message">Failed to connect to the lyric server. Check console for detailed network issues.</p>
                    `;
                }
            }

            // --- 3. Event Listener Logic (Unchanged but uses the updated fetch) ---
            songLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    const listItem = link.closest('li');
                    const targetElement = listItem.querySelector('.lyric-display-container');
                    const songTitle = listItem.getAttribute('data-song');

                    // Close all other open lyric boxes before opening a new one
                    document.querySelectorAll('.lyric-display-container').forEach(box => {
                        if (box !== targetElement && box.style.display !== 'none') {
                            box.style.display = 'none';
                            box.innerHTML = '';
                        }
                    });
                    
                    // If the box is already open, close it (toggle behavior)
                    if (targetElement.style.display !== 'none' && targetElement.innerHTML !== '') {
                        targetElement.style.display = 'none';
                        targetElement.innerHTML = '';
                        return; 
                    }

                    fetchLyrics(songTitle, targetElement);
                });
            });
        });
    </script>
</body>
</html>